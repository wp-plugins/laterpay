!function(e){e(function(){function t(){var t,s,a={itemsPerList:10,list:[],intervalToMs:{day:86400,week:604800,"2-weeks":1209600,month:2592e3},configurationSelection:e(".lp_js_selectDashboardInterval, .lp_js_selectRevenueModel"),intervalChoices:e(".lp_js_selectDashboardInterval"),revenueModelChoices:e(".lp_js_selectRevenueModel"),currentInterval:e("#lp_js_displayedInterval"),previousInterval:e("#lp_js_loadPreviousInterval"),nextInterval:e("#lp_js_loadNextInterval"),refreshDashboard:e("#lp_js_refreshDashboard"),dropdown:".lp_dropdown",dropdownList:".lp_dropdown_list",dropdownCurrentItem:".lp_dropdown_currentItem",conversionDiagram:e("#lp_js_conversionDiagram"),salesDiagram:e("#lp_js_salesDiagram"),revenueDiagram:e("#lp_js_revenueDiagram"),colorBackground:"#e3e3e3",colorBackgroundLaterpay:"#50c371",colorBorder:"#ccc",colorTextLighter:"#bbb",totalImpressionsKPI:e("#lp_js_totalImpressions"),avgConversionKPI:e("#lp_js_avgConversion"),newCustomersKPI:e("#lp_js_shareOfNewCustomers"),avgItemsSoldKPI:e("#lp_js_avg-items-sold"),totalItemsSoldKPI:e("#lp_js_total-items-sold"),avgRevenueKPI:e("#lp_js_avgRevenue"),totalRevenueKPI:e("#lp_js_totalRevenue"),bestConvertingList:e("#lp_js_bestConvertingList"),leastConvertingList:e("#lp_js_leastConvertingList"),bestSellingList:e("#lp_js_bestSellingList"),leastSellingList:e("#lp_js_leastSellingList"),bestGrossingList:e("#lp_js_bestGrossingList"),leastGrossingList:e("#lp_js_leastGrossingList"),toggleItemDetails:".lp_js_toggleItemDetails",expanded:"lp_is-expanded",selected:"lp_is-selected"},n={legend:{show:!1},xaxis:{font:{color:a.colorTextLighter,lineHeight:18},show:!0},yaxis:{font:{color:a.colorTextLighter},min:0,reserveSpace:!0,ticks:5},series:{shadowSize:0},grid:{borderWidth:{top:0,right:0,bottom:1,left:0},borderColor:a.colorBorder,tickColor:"rgba(247,247,247,0)"}},o=[{color:a.colorBackgroundLaterpay,lines:{fill:!1,gaps:!0,lineWidth:2.5,show:!0},points:{fill:!0,fillColor:a.colorBackgroundLaterpay,lineWidth:0,radius:4,show:!0}}],i=function(){e(a.dropdownCurrentItem).click(function(){e(this).parent(a.dropdown).addClass(a.expanded)}),a.configurationSelection.mousedown(function(){var t,s=a.currentInterval.data("startTimestamp");e(this).parents(a.dropdown).removeClass(a.expanded).find(a.dropdownCurrentItem).text(e(this).text()).end().find("."+a.selected).removeClass(a.selected).end().end().addClass(a.selected),t=l(),r(s,t),x(!1)}).click(function(e){e.preventDefault()}),a.nextInterval.mousedown(function(){var e,t=a.currentInterval.data("startTimestamp"),s=l(),n=new Date;return t+=86400,e=new Date(1e3*t),e.getDate()>=n.getDate()?void setMessage(lpVars.i18n.noFutureInterval,!1):(r(t,s),void x(!0))}).click(function(e){e.preventDefault()}),a.previousInterval.mousedown(function(){var e=a.currentInterval.data("startTimestamp"),t=l();e-=86400,r(e,t),x(!1)}).click(function(e){e.preventDefault()}),a.refreshDashboard.mousedown(function(){x(!0)}).click(function(e){e.preventDefault()}),e(a.revenueModelChoices).mousedown(function(){x(!0)}).click(function(e){e.preventDefault()}),e("body").on("mousedown",a.toggleItemDetails,function(){alert("Toggling post details coming soon")}).on("click",a.toggleItemDetails,function(e){e.preventDefault()})},l=function(){return a.intervalChoices.parents(a.dropdownList).find("."+a.selected).attr("data-interval")},r=function(e,t){var s,n,o,i,l=a.intervalToMs[t];s=e-l,o=new Date(1e3*e),n=new Date(1e3*s),i="day"===t?o.getDate()+"."+(o.getMonth()+1)+"."+o.getFullYear():n.getDate()+"."+(n.getMonth()+1)+"."+n.getFullYear()+" - "+o.getDate()+"."+(o.getMonth()+1)+"."+o.getFullYear(),a.currentInterval.data("startTimestamp",e).html(i)},d=function(t,s){var n,o=l(),i=a.revenueModelChoices.parents(a.dropdownList).find("."+a.selected).attr("data-revenue-model"),r={action:"laterpay_get_dashboard_data",_wpnonce:lpVars.nonces.dashboard,section:t,interval:o,count:a.itemsPerList,refresh:s?1:0,revenue_model:i,start_timestamp:a.currentInterval.data("startTimestamp")};return n=e.ajax({url:lpVars.ajaxUrl,async:!0,method:"POST",data:r}),n.done(function(e){e&&!e.success&&setMessage(e.message,e.success)}),n},c=function(e){e.addClass("lp_is-delayed"),setTimeout(function(){e.hasClass("lp_is-delayed")&&e.html('<div class="lp_loadingIndicator"></div>')},600)},u=function(e){e.hasClass("lp_is-delayed")?e.removeClass("lp_is-delayed"):e.find(".lp_loadingIndicator").remove()},g=function(o){c(a.conversionDiagram),d("converting_items",o).done(function(o){var i=[];for(t=0,s=o.data.y.length,t;s>t;t++)i.push([t+1,100]);var l={xaxis:{ticks:o.data.x},yaxis:{max:100}},r=[{data:i,bars:{align:"center",barWidth:.6,fillColor:a.colorBackground,horizontal:!1,lineWidth:0,show:!0}},{data:o.data.y,bars:{align:"center",barWidth:.4,fillColor:a.colorBackgroundLaterpay,horizontal:!1,lineWidth:0,show:!0}}];l=e.extend(!0,n,l),e.plot(a.conversionDiagram,r,l)}).always(function(){u(a.conversionDiagram)})},p=function(t){c(a.salesDiagram),d("selling_items",t).done(function(t){var s={xaxis:{ticks:t.data.x},yaxis:{max:null}},i=o;s=e.extend(!0,n,s),i[0].data=t.data.y,e.plot(a.salesDiagram,i,s)}).always(function(){u(a.salesDiagram)})},v=function(t){c(a.revenueDiagram),d("revenue_items",t).done(function(t){var s={xaxis:{ticks:t.data.x},yaxis:{max:null}},i=o;s=e.extend(!0,n,s),i[0].data=t.data.y,e.plot(a.revenueDiagram,i,s)}).always(function(){u(a.revenueDiagram)})},m=function(e){c(a.bestConvertingList),c(a.leastConvertingList),d("most_least_converting_items",e).done(function(e){e.data.most||(e.data.most={}),e.data.least||(e.data.least={}),I(a.bestConvertingList,e.data.most),w(a.bestConvertingList),I(a.leastConvertingList,e.data.least),w(a.leastConvertingList)}).always(function(){u(a.bestConvertingList),u(a.leastConvertingList)})},_=function(e){c(a.bestSellingList),c(a.leastSellingList),d("most_least_selling_items",e).done(function(e){e.data.most||(e.data.most={}),e.data.least||(e.data.least={}),I(a.bestSellingList,e.data.most),w(a.bestSellingList),I(a.leastSellingList,e.data.least),w(a.leastSellingList)}).always(function(){u(a.bestSellingList),u(a.leastSellingList)})},f=function(e){c(a.bestGrossingList),c(a.leastGrossingList),d("most_least_revenue_items",e).done(function(e){e.data.most||(e.data.most={}),e.data.least||(e.data.least={}),I(a.bestGrossingList,e.data.most),w(a.bestGrossingList),I(a.leastGrossingList,e.data.least),w(a.leastGrossingList)}).always(function(){u(a.bestGrossingList),u(a.leastGrossingList)})},h=function(e){d("metrics",e).done(function(e){a.totalImpressionsKPI.text(e.data.impressions||0),a.avgConversionKPI.text(e.data.conversion||0),a.newCustomersKPI.text(e.data.new_customers||0),a.avgItemsSoldKPI.text(e.data.avg_items_sold||0),a.totalItemsSoldKPI.text(e.data.total_items_sold||0),a.avgRevenueKPI.text(e.data.avg_purchase||0),a.totalRevenueKPI.text(e.data.total_revenue||0)})},I=function(e,n){if(a.list=[],t=0,s=n?n.length:0,s>0)for(;s>t;t++)a.list.push(L(n[t].post_id,n[t].post_title,n[t].amount,n[t].unit,n[t].sparkline));else a.list=["<dfn>"+lpVars.i18n.noData+"</dfn>"];e.html(a.list.join(""))},L=function(e,t,s,a,n){var o=a?s+"<small>"+a+"</small>":s,i="lp_value";return("%"===a||""===a)&&(i="lp_value-narrow"),'<li><span class="lp_sparklineBar">'+n+'</span><strong class="'+i+'">'+o+'</strong><i><a href="#" class="lp_js_toggleItemDetails">'+t+"</a></i></li>"},w=function(t){var s=e(".lp_sparklineBar",t),n=s.first().text().split(",").length;n>8?s.peity("line",{fill:a.colorBackground,height:14,stroke:a.colorBorder,width:34}):s.peity("bar",{fill:function(){return a.colorBorder},gap:1,height:14,width:34})},x=function(e){e=e||!1,g(e),v(e),p(e),h(e),m(e),f(e),_(e)},D=function(){i(),x()};D()}t()})}(jQuery);