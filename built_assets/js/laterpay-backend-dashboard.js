!function(e){e(function(){function t(){var t,s,n={daysBack:8,itemsPerList:10,list:[],configurationSelection:e(".lp_js_selectDashboardInterval, .lp_js_selectRevenueModel"),intervalChoices:e(".lp_js_selectDashboardInterval"),revenueModelChoices:e(".lp_js_selectRevenueModel"),currentInterval:e("#lp_js_displayedInterval"),previousInterval:e("#lp_js_loadPreviousInterval"),nextInterval:e("#lp_js_loadNextInterval"),refreshDashboard:e("#lp_js_refreshDashboard"),dropdown:".lp_dropdown",dropdownList:".lp_dropdown_list",dropdownCurrentItem:".lp_dropdown_currentItem",conversionDiagram:e("#lp_js_conversionDiagram"),salesDiagram:e("#lp_js_salesDiagram"),revenueDiagram:e("#lp_js_revenueDiagram"),colorBackground:"#e3e3e3",colorBackgroundLaterpay:"#50c371",colorBorder:"#ccc",colorTextLighter:"#bbb",totalImpressionsKPI:e("#lp_js_totalImpressions"),avgConversionKPI:e("#lp_js_avgConversion"),newCustomersKPI:e("#lp_js_shareOfNewCustomers"),avgItemsSoldKPI:e("#lp_js_avg-items-sold"),totalItemsSoldKPI:e("#lp_js_total-items-sold"),avgRevenueKPI:e("#lp_js_avgRevenue"),totalRevenueKPI:e("#lp_js_totalRevenue"),bestConvertingList:e("#lp_js_bestConvertingList"),leastConvertingList:e("#lp_js_leastConvertingList"),bestSellingList:e("#lp_js_bestSellingList"),leastSellingList:e("#lp_js_leastSellingList"),bestGrossingList:e("#lp_js_bestGrossingList"),leastGrossingList:e("#lp_js_leastGrossingList"),toggleItemDetails:".lp_js_toggleItemDetails",expanded:"lp_is-expanded",selected:"lp_is-selected"},a={legend:{show:!1},xaxis:{font:{color:n.colorTextLighter,lineHeight:18},show:!0},yaxis:{font:{color:n.colorTextLighter},min:0,reserveSpace:!0,ticks:5},series:{shadowSize:0},grid:{borderWidth:{top:0,right:0,bottom:1,left:0},borderColor:n.colorBorder,tickColor:"rgba(247,247,247,0)"}},o=[{color:n.colorBackgroundLaterpay,lines:{fill:!1,gaps:!0,lineWidth:2.5,show:!0},points:{fill:!0,fillColor:n.colorBackgroundLaterpay,lineWidth:0,radius:4,show:!0}}],i=function(){e(n.dropdownCurrentItem).click(function(){e(this).parent(n.dropdown).addClass(n.expanded)}),n.configurationSelection.mousedown(function(){e(this).parents(n.dropdown).removeClass(n.expanded).find(n.dropdownCurrentItem).text(e(this).text()).end().find("."+n.selected).removeClass(n.selected).end().end().addClass(n.selected),x()}).click(function(e){e.preventDefault()}),n.nextInterval.mousedown(function(){alert("Showing next interval coming soon")}).click(function(e){e.preventDefault()}),n.previousInterval.mousedown(function(){alert("Showing previous interval coming soon")}).click(function(e){e.preventDefault()}),n.refreshDashboard.mousedown(function(){x(!0)}).click(function(e){e.preventDefault()}),e("body").on("mousedown",n.toggleItemDetails,function(){alert("Toggling post details coming soon")}).on("click",n.toggleItemDetails,function(e){e.preventDefault()}),e(n.revenueModelChoices).mousedown(function(){alert("Filtering by revenue model coming soon")}).click(function(e){e.preventDefault()})},l=function(t,s){var a,o=n.intervalChoices.parents(n.dropdownList).find("."+n.selected).attr("data-interval"),i=n.revenueModelChoices.parents(n.dropdownList).find("."+n.selected).attr("data-revenue-model"),l={action:"laterpay_get_dashboard_data",_wpnonce:lpVars.nonces.dashboard,section:t,interval:o,count:n.itemsPerList,refresh:s?1:0,revenue_model:i};return a=e.ajax({url:lpVars.ajaxUrl,async:!0,method:"POST",data:l}),a.done(function(e){e&&!e.success&&setMessage(e.message,e.success)}),a},r=function(e){e.addClass("lp_is-delayed"),setTimeout(function(){e.hasClass("lp_is-delayed")&&e.html('<div class="lp_loadingIndicator"></div>')},600)},d=function(e){e.hasClass("lp_is-delayed")?e.removeClass("lp_is-delayed"):e.find(".lp_loadingIndicator").remove()},c=function(o){r(n.conversionDiagram),l("converting_items",o).done(function(o){var i=[];for(t=0,s=o.data.y.length,t;s>t;t++)i.push([t+1,100]);var l={xaxis:{ticks:o.data.x},yaxis:{max:100}},r=[{data:i,bars:{align:"center",barWidth:.6,fillColor:n.colorBackground,horizontal:!1,lineWidth:0,show:!0}},{data:o.data.y,bars:{align:"center",barWidth:.4,fillColor:n.colorBackgroundLaterpay,horizontal:!1,lineWidth:0,show:!0}}];l=e.extend(!0,a,l),e.plot(n.conversionDiagram,r,l)}).always(function(){d(n.conversionDiagram)})},u=function(t){r(n.salesDiagram),l("selling_items",t).done(function(t){var s={xaxis:{ticks:t.data.x},yaxis:{max:null}},i=o;s=e.extend(!0,a,s),i[0].data=t.data.y,e.plot(n.salesDiagram,i,s)}).always(function(){d(n.salesDiagram)})},g=function(t){r(n.revenueDiagram),l("revenue_items",t).done(function(t){var s={xaxis:{ticks:t.data.x},yaxis:{max:null}},i=o;s=e.extend(!0,a,s),i[0].data=t.data.y,e.plot(n.revenueDiagram,i,s)}).always(function(){d(n.revenueDiagram)})},p=function(e){r(n.bestConvertingList),r(n.leastConvertingList),l("most_least_converting_items",e).done(function(e){e.data.most||(e.data.most={}),e.data.least||(e.data.least={}),f(n.bestConvertingList,e.data.most),L(n.bestConvertingList),f(n.leastConvertingList,e.data.least),L(n.leastConvertingList)}).always(function(){d(n.bestConvertingList),d(n.leastConvertingList)})},v=function(e){r(n.bestSellingList),r(n.leastSellingList),l("most_least_selling_items",e).done(function(e){e.data.most||(e.data.most={}),e.data.least||(e.data.least={}),f(n.bestSellingList,e.data.most),L(n.bestSellingList),f(n.leastSellingList,e.data.least),L(n.leastSellingList)}).always(function(){d(n.bestSellingList),d(n.leastSellingList)})},_=function(e){r(n.bestGrossingList),r(n.leastGrossingList),l("most_least_revenue_items",e).done(function(e){e.data.most||(e.data.most={}),e.data.least||(e.data.least={}),f(n.bestGrossingList,e.data.most),L(n.bestGrossingList),f(n.leastGrossingList,e.data.least),L(n.leastGrossingList)}).always(function(){d(n.bestGrossingList),d(n.leastGrossingList)})},m=function(e){l("metrics",e).done(function(e){n.totalImpressionsKPI.text(e.data.impressions||0),n.avgConversionKPI.text(e.data.conversion||0),n.newCustomersKPI.text(e.data.new_customers||0),n.avgItemsSoldKPI.text(e.data.avg_items_sold||0),n.totalItemsSoldKPI.text(e.data.total_items_sold||0),n.avgRevenueKPI.text(e.data.avg_purchase||0),n.totalRevenueKPI.text(e.data.total_revenue||0)})},f=function(e,a){if(n.list=[],t=0,s=a?a.length:0,s>0)for(;s>t;t++)n.list.push(h(a[t].post_id,a[t].post_title,a[t].amount,a[t].unit,a[t].sparkline));else n.list=["<dfn>"+lpVars.i18n.noData+"</dfn>"];e.html(n.list.join(""))},h=function(e,t,s,n,a){var o=n?s+"<small>"+n+"</small>":s,i="lp_value";return("%"===n||""===n)&&(i="lp_value-narrow"),'<li><span class="lp_sparklineBar">'+a+'</span><strong class="'+i+'">'+o+'</strong><i><a href="#" class="lp_js_toggleItemDetails">'+t+"</a></i></li>"},L=function(t){e(".lp_sparklineBar",t).peity("bar",{width:34,height:14,gap:1,fill:function(){return"#ccc"}})},x=function(e){e=e||!1,c(e),g(e),u(e),m(e),p(e),_(e),v(e)},I=function(){i(),x()};I()}t()})}(jQuery);