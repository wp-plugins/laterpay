!function(t){t(function(){function i(){var i={postStatisticsPane:t("#lp_js_postStatistics"),postPreviewModeForm:t("#lp_js_postStatistics_pluginPreviewModeForm"),postPreviewModeToggle:t("#lp_js_togglePostPreviewMode"),postPreviewModeInput:t("#lp_js_postPreviewModeInput"),postStatisticsVisibilityForm:t("#lp_js_postStatistics_visibilityForm"),postStatisticsVisibilityToggle:t("#lp_js_togglePostStatisticsVisibility"),postStatisticsVisibilityInput:t("#lp_js_postStatistics_visibilityInput"),timePass:".lp_js_timePass",flipTimePassLink:".lp_js_flipTimePass",timePassPreviewPrice:".lp_js_timePassPreviewPrice",voucherCodeWrapper:"#lp_js_voucherCodeWrapper",voucherCodeInput:".lp_js_voucherCodeInput",voucherRedeemButton:".lp_js_voucherRedeemButton",postContentPlaceholder:t("#lp_js_postContentPlaceholder"),postStatisticsPlaceholder:t("#lp_js_postStatisticsPlaceholder"),postRatingPlaceholder:t("#lp_js_postRatingPlaceholder"),purchaseLink:".lp_js_doPurchase",postRatingForm:t(".lp_js_ratingForm"),postRatingRadio:t("input[type=radio][name=rating_value]"),hidden:"lp_is-hidden",fadingOut:"lp_is-fading-out"},e=function(){i.postStatisticsPane=t("#lp_js_postStatistics"),i.postPreviewModeForm=t("#lp_js_postStatistics_pluginPreviewModeForm"),i.postPreviewModeToggle=t("#lp_js_togglePostPreviewMode"),i.postPreviewModeInput=t("#lp_js_postPreviewModeInput"),i.postStatisticsVisibilityForm=t("#lp_js_postStatistics_visibilityForm"),i.postStatisticsVisibilityToggle=t("#lp_js_togglePostStatisticsVisibility"),i.postStatisticsVisibilityInput=t("#lp_js_postStatistics_visibilityInput")},o=function(){i.postRatingForm=t(".lp_js_ratingForm"),i.postRatingRadio=t("input[type=radio][name=rating_value]")},s=function(){t("body").on("mousedown",i.purchaseLink,function(){P(this)}).on("click",i.purchaseLink,function(t){t.preventDefault()}),t("body").on("click",i.flipTimePassLink,function(){V(this)}).on("click",i.flipTimePassLink,function(t){t.preventDefault()})},a=function(){i.postStatisticsVisibilityToggle.on("mousedown",function(){f()}).on("click",function(t){t.preventDefault()}),i.postPreviewModeToggle.on("change",function(){h()})},n=function(){i.postRatingRadio.on("change",function(){u()})},r=function(){t(i.voucherRedeemButton).on("mousedown",function(){l()}).on("click",function(t){t.preventDefault()})},l=function(){var e=t(i.voucherCodeInput).val();6===e.length?t.get(lpVars.ajaxUrl,{action:"laterpay_redeem_voucher_code",code:e,nonce:lpVars.nonces.voucher,link:window.location.href},function(o){if(t(i.voucherCodeInput).val(""),o.success){var s,a=!1;t(i.timePass).each(function(){if(s=t(this).data("pass-id"),s===o.pass_id){var e=o.price+"<small>"+lpVars.default_currency+"</small>";return t(this).find(i.purchaseLink).attr("data-laterpay",o.url).html(e),t(this).find(i.timePassPreviewPrice).html(e),a=!0,!1}}),p(a?lpVars.i18n.validVoucher:e+lpVars.i18n.invalidVoucher)}else p(e+lpVars.i18n.invalidVoucher)},"json"):p(lpVars.i18n.codeTooShort)},p=function(e){var o=t('<div class="lp_voucherCodeFeedbackMessage" style="display:none;">'+e+"</div>");t(i.voucherCodeWrapper).prepend(o),o=t(".lp_voucherCodeFeedbackMessage",i.voucherCodeWrapper),o.fadeIn(250).click(function(){c(o)}),setTimeout(function(){c(o)},3e3)},c=function(t){t.fadeOut(250,function(){t.unbind().remove()})},u=function(){t.post(lpVars.ajaxUrl,i.postRatingForm.serializeArray(),function(e){e.success&&(t(".lp_rating",i.postRatingForm).addClass(i.fadingOut).html(e.message),setTimeout(function(){i.postRatingForm.fadeOut(400,function(){t(this).remove()})},4e3))},"json")},d=function(){t.get(lpVars.ajaxUrl,{action:"laterpay_post_rating_summary",post_id:lpVars.post_id,nonce:lpVars.nonces.rating},function(t){t&&i.postRatingPlaceholder.html(t)})},_=function(){t.get(lpVars.ajaxUrl,{action:"laterpay_post_statistic_render",post_id:lpVars.post_id,nonce:lpVars.nonces.statistic},function(t){t&&(i.postStatisticsPlaceholder.before(t).remove(),g())})},g=function(){e(),a(),t(".lp_sparklineBar",i.postStatisticsPane).peity("bar",{delimiter:";",width:182,height:42,gap:1,fill:function(t,i,e){var o=new Date,s=e.length,a="#999";return o.setDate(o.getDate()-(s-i)),i===s-1&&(a="#555"),(0===o.getDay()||6===o.getDay())&&(a="#c1c1c1"),a}}),t(".lp_sparklineBackgroundBar",i.postStatisticsPane).peity("bar",{delimiter:";",width:182,height:42,gap:1,fill:function(){return"#ddd"}})},f=function(){var e=i.postStatisticsPane.hasClass(i.hidden)?"0":"1";i.postStatisticsVisibilityInput.val(e),i.postStatisticsPane.toggleClass(i.hidden),t.post(lpVars.ajaxUrl,i.postStatisticsVisibilityForm.serializeArray())},h=function(){i.postPreviewModeInput.val(i.postPreviewModeToggle.prop("checked")?1:0),t.post(lpVars.ajaxUrl,i.postPreviewModeForm.serializeArray(),function(){window.location.reload()})},v=function(){t.get(lpVars.ajaxUrl,{action:"laterpay_post_load_purchased_content",post_id:lpVars.post_id,nonce:lpVars.nonces.content},function(t){t&&(i.postContentPlaceholder.html(t),o(),n())})},m=function(){t.post(lpVars.ajaxUrl,{action:"laterpay_post_track_views",post_id:lpVars.post_id,nonce:lpVars.nonces.tracking})},P=function(i){t(i).data("preview-as-visitor")&&alert(lpVars.i18n.alert)},y=function(){lpVars.download_attachment&&(window.location.href=lpVars.download_attachment)},V=function(i){t(i).parents(".lp_timePass").toggleClass("lp_is-flipped")},w=function(){1===i.postContentPlaceholder.length&&(v(),m()),1===i.postStatisticsPlaceholder.length&&_(),1===i.postRatingPlaceholder.length&&d(),s(),n(),r(),y()};w()}i()})}(jQuery),YUI().use("node","laterpay-dialog","laterpay-iframe","laterpay-easyxdm",function(t){var i={showCloseBtn:!0,canSkipAddToInvoice:!1},e=new t.LaterPay.DialogManager;t.one(t.config.doc).delegate("click",function(t){if(t.preventDefault(),t.currentTarget.getData("preview-as-visitor"))alert(lpVars.i18n.alert);else{var o=t.currentTarget.getAttribute("href");t.currentTarget.hasAttribute("data-laterpay")&&(o=t.currentTarget.getAttribute("data-laterpay")),e.openDialog(o,i.showCloseBtn)}},".lp_js_doPurchase")});