!function(e){e(function(){function t(){var t={apiKeyInput:e(".lp_js_validateApiKey"),merchantIdInput:e(".lp_js_validateMerchantId"),apiCredentialsInputs:e(".lp_js_validateApiKey, .lp_js_validateMerchantId"),testMerchantId:e("#lp_js_sandboxMerchantId"),testApiKey:e("#lp_js_sandboxApiKey"),liveMerchantId:e("#lp_js_liveMerchantId"),liveApiKey:e("#lp_js_liveApiKey"),pluginModeIndicator:e("#lp_js_pluginModeIndicator"),pluginModeToggle:e("#lp_js_togglePluginMode"),pluginVisibilitySetting:e("#lp_js_pluginVisibilitySetting"),pluginVisibilityToggle:e("#lp_js_toggleVisibilityInTestMode"),pluginModeTestText:e("#lp_js_pluginMode_testText"),pluginModeLiveText:e("#lp_js_pluginMode_liveText"),hasInvalidSandboxCredentials:e("#lp_js_hasInvalidSandboxCredentials"),isLive:"lp_is-live",showMerchantContractsButton:e("#lp_js_showMerchantContracts"),throttledFlashMessage:void 0,flashMessageTimeout:800,requestSent:!1},i=function(){t.apiKeyInput.bind("input",function(){var e=this;setTimeout(function(){r(e)},50)}),t.merchantIdInput.bind("input",function(){var e=this;setTimeout(function(){d(e)},50)}),t.pluginModeToggle.change(function(){s()}),t.pluginVisibilityToggle.change(function(){a()}),window.onbeforeunload=function(){c()},t.showMerchantContractsButton.mousedown(function(){u()}).click(function(e){e.preventDefault()})},n=function(){for(var e=0,i=t.apiCredentialsInputs.length;i>e;e++)if(""===t.apiCredentialsInputs.eq(e).val())return void t.apiCredentialsInputs.eq(e).focus()},a=function(){p()?(t.hasInvalidSandboxCredentials.val(1),t.pluginVisibilityToggle.prop("checked",!1),t.testMerchantId.focus(),t.requestSent=!1):t.hasInvalidSandboxCredentials.val(0),o("laterpay_test_mode")},l=function(i){"live"===i?(t.showMerchantContractsButton.fadeOut(250),t.pluginModeTestText.hide(),t.pluginModeLiveText.show(),t.pluginModeIndicator.fadeOut(),e(".lp_liveCredentials").addClass(t.isLive),t.pluginVisibilityToggle.prop("checked",!1)):(t.showMerchantContractsButton.fadeIn(250),t.pluginModeTestText.show(),t.pluginModeLiveText.hide(),t.pluginModeIndicator.fadeIn(),e(".lp_liveCredentials").removeClass(t.isLive))},s=function(){var e=t.pluginModeToggle,i=e.prop("checked");p()?(e.prop("checked",!1),t.liveMerchantId.focus(),t.requestSent=!1,t.pluginVisibilitySetting.fadeIn(250)):i?t.pluginVisibilitySetting.fadeOut(250):t.pluginVisibilitySetting.fadeIn(250),o("laterpay_plugin_mode")},o=function(i){t.requestSent||(t.requestSent=!0,e.post(ajaxurl,e("#"+i).serializeArray(),function(e){setMessage(e.message,e.success),l(e.mode)},"json").done(function(){t.requestSent=!1}))},r=function(i){var n=e(i),l=n.parents("form"),r=n.val().trim(),d=32;if(window.clearTimeout(t.throttledFlashMessage),r.length!==n.val().length&&n.val(r),0===r.length||r.length===d)o(l.attr("id"));else{t.throttledFlashMessage=window.setTimeout(function(){setMessage(lpVars.i18nApiKeyInvalid,!1)},t.flashMessageTimeout);var u=t.testApiKey.parents("form").attr("id");l.attr("id")===u&&a()}p()&&s()},d=function(i){var n=e(i),l=n.parents("form"),r=n.val().trim(),d=22;if(window.clearTimeout(t.throttledFlashMessage),r.length!==n.val().length&&n.val(r),0===r.length||r.length===d)o(l.attr("id"));else{t.throttledFlashMessage=window.setTimeout(function(){setMessage(lpVars.i18nMerchantIdInvalid,!1)},t.flashMessageTimeout);var u=t.testMerchantId.parents("form").attr("id");l.attr("id")===u&&a()}p()&&s()},p=function(){return!t.pluginModeToggle.prop("checked")&&(32!==t.testApiKey.val().length||22!==t.testMerchantId.val().length)||t.pluginModeToggle.prop("checked")&&(32!==t.liveApiKey.val().length||22!==t.liveMerchantId.val().length)?!0:!1},u=function(){var i,n,a="https://laterpay.net/terms/index.html?group=merchant-contract",l=parseInt(e(window).height(),10),s=parseInt(e("#wpadminbar").height(),10)+26,o=l-s,r=e('<div id="lp_legalDocs_iframe" style="height:'+o+'px;"></div>'),d=e("#lp_legalDocs_iframe");t.showMerchantContractsButton.fadeOut(),0!==e("iframe",d).length&&e("iframe",d).remove(),0===d.length&&e("#lp_js_credentialsHint").after(r.slideDown(400,function(){i=e("#lp_legalDocs_iframe").offset(),n=i.top-s,e("BODY, HTML").animate({scrollTop:n},400)})),d=e("#lp_legalDocs_iframe"),d.html('<a href="#" id="lp_js_hideMerchantContracts" class="lp_legalDocs_closeLink">x</a><iframe src="'+a+'" frameborder="0" height="'+o+'" width="100%"></iframe>'),e("#lp_js_hideMerchantContracts",d).bind("click",function(i){e(this).fadeOut().parent("#lp_legalDocs_iframe").slideUp(400,function(){e(this).remove()}),t.showMerchantContractsButton.fadeIn(),i.preventDefault()})},c=function(){return p()?lpVars.i18nPreventUnload:void 0},g=function(){i(),n()};g()}t()})}(jQuery);