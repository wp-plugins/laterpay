!function(e){e(function(){function t(){var t={apiKeyInput:e(".lp_js_validateApiKey"),merchantIdInput:e(".lp_js_validateMerchantId"),isLive:"lp_is-live",pluginModeToggle:e("#lp_js_togglePluginMode"),showMerchantContractsButton:e("#lp_js_showMerchantContracts"),throttledFlashMessage:void 0,flashMessageTimeout:800,requestSent:!1},n=function(){t.apiKeyInput.bind("input",function(){var e=this;setTimeout(function(){s(e)},50)}),t.merchantIdInput.bind("input",function(){var e=this;setTimeout(function(){r(e)},50)}),t.pluginModeToggle.change(function(){a()}),window.onbeforeunload=function(){p()},t.showMerchantContractsButton.mousedown(function(){c()}).click(function(e){e.preventDefault()})},i=function(){for(var t=e(".lp_js_validateApiKey, .lp_js_validateMerchantId"),n=0,i=t.length;i>n;n++)if(""===t.eq(n).val())return void t.eq(n).focus()},l=function(n){"live"===n?(e("#lp_js_pluginMode_testText").hide(),e("#lp_js_pluginMode_liveText").show(),e("#lp_js_pluginModeIndicator").fadeOut(),e(".lp_liveCredentials").addClass(t.isLive)):(e("#lp_js_pluginMode_liveText").hide(),e("#lp_js_pluginMode_testText").show(),e("#lp_js_pluginModeIndicator").fadeIn(),e(".lp_liveCredentials").removeClass(t.isLive))},a=function(){var n=t.pluginModeToggle,i=e("#lp_js_pluginMode_hiddenInput"),l=0,a=1,s=n.prop("checked");d()?(i.val(l),n.prop("checked",!1),t.requestSent=!1):i.val(s?a:l),o("laterpay_plugin_mode")},o=function(n){t.requestSent||(t.requestSent=!0,e.post(ajaxurl,e("#"+n).serializeArray(),function(e){setMessage(e.message,e.success),l(e.mode)},"json").done(function(){t.requestSent=!1}))},s=function(n){var i=e(n),l=i.parents("form"),s=i.val().trim(),r=32;window.clearTimeout(t.throttledFlashMessage),s.length!==i.val().length&&i.val(s),0===s.length||s.length===r?o(l.attr("id")):t.throttledFlashMessage=window.setTimeout(function(){setMessage(lpVars.i18nApiKeyInvalid,!1)},t.flashMessageTimeout),d()&&a()},r=function(n){var i=e(n),l=i.parents("form"),s=i.val().trim(),r=22;window.clearTimeout(t.throttledFlashMessage),s.length!==i.val().length&&i.val(s),0===s.length||s.length===r?o(l.attr("id")):t.throttledFlashMessage=window.setTimeout(function(){setMessage(lpVars.i18nMerchantIdInvalid,!1)},t.flashMessageTimeout),d()&&a()},d=function(){return!t.pluginModeToggle.prop("checked")&&(32!==e("#lp_js_sandboxApiKey").val().length||22!==e("#lp_js_sandboxMerchantId").val().length)||t.pluginModeToggle.prop("checked")&&(32!==e("#lp_js_liveApiKey").val().length||22!==e("#lp_js_liveMerchantId").val().length)?!0:!1},c=function(){var n,i,l="https://laterpay.net/terms/index.html?group=merchant-contract",a=parseInt(e(window).height(),10),o=parseInt(e("#wpadminbar").height(),10)+26,s=a-o,r=e('<div id="lp_legalDocs_iframe" style="height:'+s+'px;"></div>'),d=e("#lp_legalDocs_iframe");t.showMerchantContractsButton.fadeOut(),0!==e("iframe",d).length&&e("iframe",d).remove(),0===d.length&&e("#lp_js_credentialsHint").after(r.slideDown(400,function(){n=e("#lp_legalDocs_iframe").offset(),i=n.top-o,e("BODY, HTML").animate({scrollTop:i},400)})),d=e("#lp_legalDocs_iframe"),d.html('<a href="#" id="lp_js_hideMerchantContracts" class="lp_legalDocs_closeLink">x</a><iframe src="'+l+'" frameborder="0" height="'+s+'" width="100%"></iframe>'),e("#lp_js_hideMerchantContracts",d).bind("click",function(n){e(this).fadeOut().parent("#lp_legalDocs_iframe").slideUp(400,function(){e(this).remove()}),t.showMerchantContractsButton.fadeIn(),n.preventDefault()})},p=function(){return d()?lpVars.i18nPreventUnload:void 0},u=function(){n(),i()};u()}t()})}(jQuery);